!function(t,n){"use strict";var i={_init:!1,_loadAssets:!0,_appkey:null,_appurl:null,_mapcontainer:null,_controlscontainer:"indawo_controls",_ctrl_attribute:"indawo_pwr",_attr_url:"http://www.i2csystems.com",_ctrl_options:"indawo_options",_ctrl_errors:"indawo_errors",_giscontainer:"indawo_map",_isLoggedIn:!1,_token:null,_api_url_prefix:"/api/v1/",_login_atttempts:0,_settings:{center:{lat:0,lng:0},scale:5},_icons:[],_locations:[],_markers:{},_infowindow:null,_iconset:{},_products:[],_icon_paths:{CIR:0,BCA:3,BOA:4,FCA:1,FOA:2},_social:{Facebook:'<span class="fab fa-facebook-square fa-2x socialicon facebook" title="Facebook"></span>',Twitter:'<span class="fab fa-twitter-square fa-2x socialicon twitter" title="Twitter"></span>',Instagram:'<span class="fab fa-instagram fa-2x socialicon instagram" title="Instagram"></span>',"Google+":'<span class="fab fa-google-plus-square fa-2x socialicon googleplus" title="Google+"></span>',LinkedIn:'<span class="fab fa-linkedin fa-2x socialicon linkedin" title="LinkedIn"></span>'},map:null,_control_headers:{Accept:"application/json"},init:function(t,e,l){if(this._init)return!1;this._appurl=t,this._appkey=e,this._mapcontainer=l,function(){var t=n("#"+i._mapcontainer),a=parseInt(t.css("height")),o=parseInt(t.css("width"));0===a&&(t.css("height",450),a=450);0===o&&(t.css("width",450),o=450);e=a-45,s=n("#"+i._mapcontainer),r=n("<div >",{id:i._controlscontainer,class:"indawo-control",style:"height: 40px;background-color: #5e472a;font-size: .90rem;"}),l=n("<span >",{id:i._ctrl_errors,class:"indawo-error indawo-hide",style:"display: inline-block;color: #dd4b39;background-color: #dfd9d9;font-size: .9rem;font-style: italic;margin-right: 8px;padding: 6px;border-radius: 4px;margin-left: 8px;margin-top: 4px;"}),c=n("<span >",{id:i._ctrl_options,class:"indawo-options",style:"display: inline;margin-right: 8px;padding: 8px;"}),f="&nbsp;Powered By : <a href='"+i._attr_url+"' target='_blank'>INDAWO</a>",g=n("<span >",{id:i._ctrl_attribute,class:"indawo-attribute",style:"display: inline;color: #fff;font-size: .80rem;font-style: italic;text-align: right;margin-left: 8px;margin-right: 4px;padding: 8px;float: right;"}),g.html(f),p=g,u=e,_="height: "+u+"px;",d=n("<div >",{id:i._giscontainer,style:_}),r.append(l),r.append(c),r.append(p),s.append(r),s.append(d);var e,s,r,l,c,p,d,u,_,f,g}(),r(null),!1===this._isLoggedIn&&a(function(){o(function(t){i._settings=t.settings,function(t,a){if(a=a||null,i._loadAssets)try{t.js.forEach(function(t){n.loadScript(t,function(){})}),t.css.forEach(function(t){var a;a=t,n.ajax({url:i._appurl+i._api_url_prefix+"getcss",dataType:"text",data:{filename:a},async:!0,headers:i._control_headers}).done(function(t){var i=JSON.parse(t);n("<style></style>").appendTo("head").html(i.css)})}),t.cssf.forEach(function(t){var a=i._appurl+"/"+t,o='<link rel="stylesheet" href="'+a+'" >';n("head").append(o)}),t.jsf.forEach(function(t){var a=i._appurl+"/"+t;n.loadScript(a,function(){})}),s(),a(!0)}catch(t){console.error(t),a(!1)}else s(),a(!0)}(t,function(t){})})}),this._init=!0},getIconMaster:function(t){return null!==this._icon_paths[t]?this._icon_paths[t]:this._icon_paths.CIR},NoLoadAssets:function(){this._loadAssets=!1},version:function(){return this.VERSION},init_map:function(){!function(t){t=t||null,c(i._ctrl_errors,!0),i._isLoggedIn&&(a=(a=function(a){var o;i._locations=a,o=(o=function(a){var o,s;i._icons=a,(o=i).iconset={},o._icons.forEach(function(t){null!==t.distibutor&&t.distibutor.length>0&&(o._iconset[t.distibutor]={},o._iconset[t.distibutor].path=o.getIconMaster(t.path),o._iconset[t.distibutor].scale=parseInt(t.scale),o._iconset[t.distibutor].fillColor=t.fillColor,o._iconset[t.distibutor].fillOpacity=parseFloat(t.fillOpacity),o._iconset[t.distibutor].strokeColor=t.strokeColor,o._iconset[t.distibutor].strokeOpacity=parseFloat(t.strokeOpacity),o._iconset[t.distibutor].strokeWeight=parseInt(t.strokeWeight))}),s=(s=function(n){i._products=n,!l(t)||t(!0)})||null,n.ajax({url:i._appurl+i._api_url_prefix+"products",dataType:"json",data:null,async:!0}).done(function(t){!l(s)||s(t.products)}).fail(function(t){e(t.status)})})||null,n.ajax({url:i._appurl+i._api_url_prefix+"mapicons",dataType:"json",data:null,async:!0}).done(function(t){!l(o)||o(t.icons)}).fail(function(t){e(t.status)})})||null,n.ajax({url:i._appurl+i._api_url_prefix+"distributors",dataType:"json",data:null,async:!0}).done(function(t){!l(a)||a(t.distributors)}).fail(function(t){e(t.status)}));var a}(function(t){if(t){n("#"+i._giscontainer).empty();i.map=new google.maps.Map(document.getElementById(i._giscontainer),{zoom:i._settings.scale,center:i._settings.center,mapTypeId:google.maps.MapTypeId.ROADMAP})}!function(t){t=t||null;var a=i,o=0;a._infowindow=new google.maps.InfoWindow,a._locations.forEach(function(e){""!==e.map_config.showonmap&&(a._markers[e._id]=new google.maps.Marker({position:{lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)},icon:a._iconset[e.type],map:a.map,title:e.name,id:e._id}),a._markers[e._id].addListener("click",function(t){var a,o,e,s;a=n(this),o=i,e=a[0].id,function(t,a){a=a||null,t.map_config;var o,e,s,r,c,u,_,f,g,h='<div id="iw-container">'+(f=(_=g=t).name,!p(_.web)||"all"!==_.map_config.showlinks&&"www"!==_.map_config.showlinks||(f="<a href='"+_.web+"' target='_blank'>"+_.name+"</a>"),'<div class="iw-title">'+f+"</div>")+(c=i,u='<div class="iw-content">',p((o=g).logo)&&24===o.logo.length&&(u+="<img src='"+c._appurl+"/img/"+o.logo+"' alt='"+o.name+"' width='83' >"),u+=o.descr+(e=o,s=i,r="<div class='iw-social'>",n.each(e.social,function(t,n){p(n)&&(r+='<span><a href="'+n+'" target="_blank" >'+s._social[t]+"</a></span>")}),r+="</div>"),function(t,n){n=n||null;var a=i,o="",e=t.products.length,s=0;e>0&&(o="<div class='iw-subTitle'>Products</div><div class='iw-products'>",t.products.forEach(function(t){!function(t,n){n=n||null;var a=d(i._products,t,"_id");!l(n)||n(a)}(t,function(t){var i="<div class='productdisp'>";p(t.url)?(i+="<a href='"+t.url+"' target='_blank' title='"+t.name+"'>",i+="<img src='"+a._appurl+"/img/"+t.map+"' alt='"+t.name+"'  >",i+="</a>"):i+="<img src='"+a._appurl+"/img/"+t.map+"' alt='"+t.name+"' title='"+t.name+"' >",o+="</div>",o+=i,++s>=e&&(o+="</div>",o+="</div>",l(n)&&n(o))})}))}(o,function(t){u+=t}),u+="</div>")+'<div class="iw-bottom-gradient"></div></div>';l(a)&&a(h)}(s=d(o._locations,e,"_id"),function(t){o._infowindow.setContent(t),o._infowindow.open(o.map,o._markers[s._id])})})),++o>=a._locations.length&&(!l(t)||t())})}()})},setInfoWindowStyle:function(){google.maps.event.addListener(i._infowindow,"domready",function(){var t=n(".gm-style-iw"),i=t.prev();i.children(":nth-child(2)").css({display:"none"}),i.children(":nth-child(4)").css({display:"none"}),t.parent().parent().css({left:"115px"}),i.children(":nth-child(1)").attr("style",function(t,n){return n+"left: 76px !important;"}),i.children(":nth-child(3)").attr("style",function(t,n){return n+"left: 76px !important;"}),i.children(":nth-child(3)").find("div").children().css({"box-shadow":"rgba(72, 181, 233, 0.6) 0px 1px 6px","z-index":"1"});var a=t.next();a.css({opacity:"1",right:"38px",top:"3px",border:"7px solid #48b5e9","border-radius":"13px","box-shadow":"0 0 5px #3990B9"}),n(".iw-content").height()<200&&n(".iw-bottom-gradient").css({display:"none"}),a.mouseout(function(){n(this).css({opacity:"1"})})})},getAjaxHeaders:function(){return this._control_headers},mapsReady:function(){i.init_map()}};function a(t){t=t||null,c(i._ctrl_errors,!0);var a=i._appurl+i._api_url_prefix+"auth";n.ajax({type:"POST",url:a,data:{k:i._appkey}}).done(function(n){n.auth?(i._token=n.token,r(n.token),i._isLoggedIn=!0,i._login_atttempts=0,!l(t)||t()):(i._isLoggedIn=!1,r(""),i._login_atttempts++,!l(t)||t())}).fail(function(t,n,i){console.log("return Status ",t.status,t),200!==parseInt(t.status)?(console.log("Error detected ",t.status),e(t.status)):alert("Login Failed: error code "+t.status+" Message: "+t.responseJSON.message)})}function o(t){if(t=t||null,i._isLoggedIn){var e=i._appurl+i._api_url_prefix+"mapview";n.ajax({type:"GET",url:e,data:null}).done(function(n,i,a){!l(t)||t(n)}).fail(function(t,n,e){alert("Fetching map settings failed: error code "+t.status+" Message: "+t.responseJSON.message),401===t.status&&(i._isLoggedIn=!1,i._login_atttempts<3&&a(o))})}else i._login_atttempts<3&&a(o)}function e(t){console.log("Process Error ",t);var a=n("#"+i._ctrl_errors).empty();switch(console.log("container ",a),t){case 0:console.log("display Error ",t),a.append('<span style="text-align: left;"> CORS ERROR / Network Error</span>'),c(i._ctrl_errors,!1);break;case 401:a.append('<span style="text-align: left;"> Credentials ERROR</span>'),c(i._ctrl_errors,!1);break;default:a.append('<span style="text-align: left;"> Suspected Netrwork ERROR</span>'),c(i._ctrl_errors,!1)}}function s(){n("#"+i._controlscontainer).attr("style",""),n("#"+i._ctrl_errors).attr("style",""),n("#"+i._ctrl_options).attr("style",""),n("#"+i._ctrl_attribute).attr("style","")}function r(t){var a=i.getAjaxHeaders();null!==t&&t.length>10?a.Authorization="Token "+t:a.Authorization="Token NOKEY",i._control_headers=a,n.ajaxSetup({headers:a})}function l(t){return"function"==typeof t}function c(t,i){i?n("#"+t).addClass("indawo-hide"):n("#"+t).removeClass("indawo-hide")}function p(t){if(null===typeof t)return!1;if("string"==typeof t){if(""===t)return!1;if(t.length>0)return!0}return!1}function d(t,n,i){for(var a=0;a<t.length;a++)if(t[a][i]===n)return t[a];return null}i.VERSION="1.1.0",t.idw=i,t.mapsReady=i.mapsReady,n.loadScript=function(t,i){n.ajax({url:t,dataType:"script",success:i,async:!0}).done(function(t){})}}(window,jQuery);
